---
import Layout from '../layouts/Layout.astro';
import { AdminDashboard } from '../components/AdminDashboard';

// LOGICA DE PROTECCIÓN
const ADMIN_EMAIL = "ricardosanjurg@gmail.com";
const userEmail = "ricardosanjurg@gmail.com"; // TODO: Obtener de la sesión real

const isAdmin = userEmail === ADMIN_EMAIL;

if (!isAdmin) {
  return Astro.redirect('/dashboard');
}

// Fetch de lecciones reales
const API_URL = 'https://godotapi.rsanjur.com';
let lessons = [];
try {
  const res = await fetch(`${API_URL}/api/course/1`); 
  const data = await res.json();
  lessons = data.lessons;
} catch (e) {
  lessons = [
    { id: 1, title: "Introducción", order: 1, videoUrl: "..." },
    { id: 2, title: "Nodos", order: 2, videoUrl: "..." }
  ];
}
---

<Layout title="Panel de Administración">
  <AdminDashboard client:load initialLessons={lessons} />
</Layout>
